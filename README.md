# WebServer(网页服务器)

本项目来源于牛客Linux高并发服务器项目[牛客Linux高并发服务器项目](https://www.nowcoder.com/courses/cover/live/504)，使用同步 I/O 方式模拟出 Proactor 模式。在原有项目基础之上，融入了非活跃连接的检测功能。

**同步 I/O 方式模拟出 Proactor 模式原理：**

`主线程执行数据读写操作，读写完成之后，主线程向 工作线程通知这一”完成事件“。那么从工作线程的角度来看，它们就直接获得了数据读写的结果，接下来要做的只是对读写的结果进行逻辑处理。`

**使用同步 I/O 模型（以 epoll_wait为例）模拟出的 Proactor 模式的工作流程如下：**

1. 主线程往 epoll 内核事件表中注册 socket 上的读就绪事件。
2. 主线程调用 epoll_wait 等待 socket 上有数据可读。 
3. 当 socket 上有数据可读时，epoll_wait 通知主线程。主线程从 socket 循环读取数据，直到没有更 多数据可读，然后将读取到的数据封装成一个请求对象并插入请求队列。 
4. 睡眠在请求队列上的某个工作线程被唤醒，它获得请求对象并处理客户请求，然后往 epoll 内核事 件表中注册 socket 上的写就绪事件。 
5. 主线程调用 epoll_wait 等待 socket 可写。
6. 当 socket 可写时，epoll_wait 通知主线程。主线程往 socket 上写入服务器处理客户请求的结果。

**非活跃定时检测功能：**

1. 每一个客户端都配备了一个对立的定时器，里面记录了每个连接的超时时间。并且每个定时器存入到了一个升序链表中，方便管理。
2. 捕捉信号SIGALRM，并向专门信号的文件描述符（管道）发送信号数据，并在 epoll 内核事件表中注册 socket 上的写就绪事件。
3. 当监听的文件描述符等于管道的写端时，并且监听到该管道文件描述符有写事件发生时（有非活跃连接），在本轮其他读取时间事件处理完毕后，再处理非活跃连接。
